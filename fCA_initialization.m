%% fCA_initialization 滤波初始化及参数设置

function [F,G,H,Q,Xg3,P3]=fCA_initialization(T,Z1,Z2,Z3,R3,q)

% Z1,Z2,Z3,         k=1,2,3 时的直角坐标测量向量
%  F,G,H,Q,Xg3,P3 依次为 状态转移矩阵，增益阵，测量阵，过程噪声阵，
%  k=3 时的状态估计向量，状态估计误差协方差阵

F=[1 T 1/2*T^2 0 0 0 0 0 0
   0 1 T       0 0 0 0 0 0
   0 0 1       0 0 0 0 0 0
   0 0 0 1 T 1/2*T^2 0 0 0
   0 0 0 0 1 T       0 0 0
   0 0 0 0 0 1       0 0 0
   0 0 0 0 0 0 1 T 1/2*T^2
   0 0 0 0 0 0 0 1 T
   0 0 0 0 0 0 0 0 1];

G=[1/2*T^2 T 1 0 0 0 0 0 0
   0 0 0 1/2*T^2 T 1 0 0 0
   0 0 0 0 0 0 1/2*T^2 T 1]';

%B=[1/2*T^2 T 1/2*T^2 T 1/2*T^2 T]';

H=[1 0 0 0 0 0 0 0 0
   0 0 0 1 0 0 0 0 0
   0 0 0 0 0 0 1 0 0];

Q=q^2*[1 0 0
       0 1 0
       0 0 1];

zx1=Z1(1,1);
zy1=Z1(2,1);
zz1=Z1(3,1);
zx2=Z2(1,1);
zy2=Z2(2,1);
zz2=Z2(3,1);
zx3=Z3(1,1);
zy3=Z3(2,1);
zz3=Z3(3,1);
Xg3(:,1)=[zx3
         (zx3-zx2)/T
         (zx3-2*zx2+zx1)/T^2
         zy3
         (zy3-zy2)/T
         (zy3-2*zy2+zy1)/T^2
         zz3
         (zz3-zz2)/T
         (zz3-2*zz2+zz1)/T^2];  
     
P3(:,:)=[R3(1,1)     R3(1,1)/T      R3(1,1)/T^2    R3(1,2)       R3(1,2)/T      R3(1,2)/T^2    R3(1,3)      R3(1,3)/T      R3(1,3)/T^2
         R3(1,1)/T   2*R3(1,1)/T^2  3*R3(1,1)/T^3  R3(1,2)/T     2*R3(1,2)/T^2  3*R3(1,2)/T^3  R3(1,3)/T    2*R3(1,3)/T^2  3*R3(1,3)/T^3
         R3(1,1)/T^2 3*R3(1,1)/T^3  6*R3(1,1)/T^4  R3(1,2)/T^2   3*R3(1,2)/T^3  6*R3(1,2)/T^4  R3(1,3)/T^2  3*R3(1,3)/T^3  6*R3(1,3)/T^4
         R3(1,2)     R3(1,2)/T      R3(1,2)/T^2    R3(2,2)       R3(2,2)/T      R3(2,2)/T^2    R3(2,3)      R3(2,3)/T      R3(2,3)/T^2 
         R3(1,2)/T   2*R3(1,2)/T^2  3*R3(1,2)/T^3  R3(2,2)/T     2*R3(2,2)/T^2  3*R3(2,2)/T^3  R3(2,3)/T    2*R3(2,3)/T^2  3*R3(2,3)/T^3  
         R3(1,2)/T^2 3*R3(1,2)/T^3  6*R3(1,2)/T^4  R3(2,2)/T^2   3*R3(2,2)/T^3  6*R3(2,2)/T^4  R3(2,3)/T^2  3*R3(2,3)/T^3  6*R3(2,3)/T^4
         R3(1,3)     R3(1,3)/T      R3(1,3)/T^2    R3(2,3)       R3(2,3)/T      R3(2,3)/T^2    R3(3,3)      R3(3,3)/T      R3(3,3)/T^2 
         R3(1,3)/T   2*R3(1,3)/T^2  3*R3(1,3)/T^3  R3(2,3)/T     2*R3(2,3)/T^2  3*R3(2,3)/T^3  R3(3,3)/T    2*R3(3,3)/T^2  3*R3(3,3)/T^3
         R3(1,3)/T^2 3*R3(1,3)/T^3  6*R3(1,3)/T^4  R3(2,3)/T^2   3*R3(2,3)/T^3  6*R3(2,3)/T^4  R3(3,3)/T^2  3*R3(3,3)/T^3  6*R3(3,3)/T^4];
           
